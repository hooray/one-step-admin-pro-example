
/**
 * 由 One-step-admin 提供技术支持
 * Powered by One-step-admin
 * https://one-step-admin.hurui.me
 */
    
import{e as q,r as w,o as m,h as j,w as k,c as b,d as c,a as o,y as C,b as H,E as v,_ as P,m as O,n as G,f as B,F as X,g as J,z as I,A as S,B as z,q as R,u as _,i as N}from"./index-mFYeOg6f.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-ChZ28WVx.js";import{_ as Q}from"./index-kyDnYNaY.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-Buj60MwG.js";const Y={class:"slot"},Z={key:0,class:"el-upload__tip"},x={style:{display:"inline-block"}},ee=q({name:"FileUpload",__name:"index",props:{action:{},headers:{},data:{},name:{default:"file"},size:{default:2},max:{default:3},files:{default:()=>[]},notip:{type:Boolean,default:!1},ext:{default:()=>["zip","rar"]},httpRequest:{}},emits:["onSuccess"],setup(y,{emit:h}){const p=y,$=h,s=t=>{const d=t.name.split(".").at(-1)??"",n=p.ext.includes(d),l=t.size/1024/1024<p.size;return n||v.error(`上传文件只支持 ${p.ext.join(" / ")} 格式！`),l||v.error(`上传文件大小不能超过 ${p.size}MB！`),n&&l},i=()=>{v.warning("文件上传超过限制")},E=(t,r,d)=>{$("onSuccess",t,r,d)},a=t=>{(d=>new Promise(n=>{const l=new XMLHttpRequest;l.open("GET",d,!0),l.responseType="blob",l.onload=()=>{l.status===200&&n(l.response)},l.send()}))(t.url).then(d=>{const n=document.createElement("a"),l=window.URL.createObjectURL(d),e=new MouseEvent("click");n.target="_blank",n.download=t.name,n.href=l,n.dispatchEvent(e)})};return(t,r)=>{const d=P,n=w("ElAlert"),l=w("ElUpload");return m(),j(l,{headers:t.headers,action:t.action,data:t.data,name:t.name,"before-upload":s,"on-exceed":i,"on-success":E,"on-preview":a,"http-request":t.httpRequest,"file-list":t.files,limit:t.max,drag:""},{tip:k(()=>[t.notip?C("",!0):(m(),b("div",Z,[c("div",x,[o(n,{title:`上传文件支持 ${t.ext.join(" / ")} 格式，单个文件大小不超过 ${t.size}MB，且文件数量不超过 ${t.max} 个`,type:"info","show-icon":"",closable:!1},null,8,["title"])])]))]),default:k(()=>[c("div",Y,[o(d,{name:"i-ep:upload-filled",class:"el-icon--upload"}),r[0]||(r[0]=c("div",{class:"el-upload__text"},[H(" 将文件拖到此处，或"),c("em",null,"点击上传")],-1))])]),_:1},8,["headers","action","data","name","http-request","file-list","limit"])}}}),te=L(ee,[["__scopeId","data-v-8eb44302"]]),se={class:"upload-container"},oe={class:"mask"},ae={class:"actions"},ne=["onClick"],le=["onClick"],ie=["onClick"],ce=["onClick"],pe={key:0,class:"el-upload__tip"},re={style:{display:"inline-block"}},de=q({name:"ImagesUpload",__name:"index",props:O({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},max:{default:3},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]},httpRequest:{}},{modelValue:{default:[]},modelModifiers:{}}),emits:O(["onSuccess"],["update:modelValue"]),setup(y,{emit:h}){const p=y,$=h,s=G(y,"modelValue"),i=B({dialogImageIndex:0,imageViewerVisible:!1,progress:{preview:"",percent:0}});function E(e){i.value.dialogImageIndex=e,i.value.imageViewerVisible=!0}function a(){i.value.imageViewerVisible=!1}function t(e){s.value.splice(e,1)}function r(e,f){f==="left"&&e!==0&&(s.value[e]=s.value.splice(e-1,1,s.value[e])[0]),f==="right"&&e!==s.value.length-1&&(s.value[e]=s.value.splice(e+1,1,s.value[e])[0])}const d=e=>{const U=e.name.split(".").at(-1)??"",u=p.ext.includes(U),V=e.size/1024/1024<p.size;return u||v.error(`上传图片只支持 ${p.ext.join(" / ")} 格式！`),V||v.error(`上传图片大小不能超过 ${p.size}MB！`),u&&V&&(i.value.progress.preview=URL.createObjectURL(e)),u&&V},n=e=>{i.value.progress.percent=~~e.percent},l=e=>{i.value.progress.preview="",i.value.progress.percent=0,$("onSuccess",e)};return(e,f)=>{const U=w("ElImage"),u=P,V=w("ElProgress"),A=w("ElUpload"),F=w("ElAlert"),T=w("ElImageViewer");return m(),b("div",se,[(m(!0),b(X,null,J(s.value,(D,g)=>(m(),b("div",{key:g,class:"images"},[g<e.max?(m(),j(U,{key:0,src:D,style:I(`width:${e.width}px;height:${e.height}px;`),fit:"cover"},null,8,["src","style"])):C("",!0),c("div",oe,[c("div",ae,[c("span",{title:"预览",onClick:M=>E(g)},[o(u,{name:"i-ep:zoom-in",class:"icon"})],8,ne),c("span",{title:"移除",onClick:M=>t(g)},[o(u,{name:"i-ep:delete",class:"icon"})],8,le),S(c("span",{title:"左移",class:R({disabled:g===0}),onClick:M=>r(g,"left")},[o(u,{name:"i-ep:back",class:"icon"})],10,ie),[[z,s.value.length>1]]),S(c("span",{title:"右移",class:R({disabled:g===s.value.length-1}),onClick:M=>r(g,"right")},[o(u,{name:"i-ep:right",class:"icon"})],10,ce),[[z,s.value.length>1]])])])]))),128)),S(o(A,{"show-file-list":!1,headers:e.headers,action:e.action,data:e.data,name:e.name,"before-upload":d,"on-progress":n,"on-success":l,"http-request":e.httpRequest,drag:"",class:"images-upload"},{default:k(()=>[c("div",{class:"image-slot",style:I(`width:${e.width}px;height:${e.height}px;`)},[o(u,{name:"i-ep:plus",class:"icon"})],4),S(c("div",{class:"progress",style:I(`width:${e.width}px;height:${e.height}px;`)},[o(U,{src:_(i).progress.preview,style:I(`width:${e.width}px;height:${e.height}px;`),fit:"fill"},null,8,["src","style"]),o(V,{type:"circle",width:Math.min(e.width,e.height)*.8,percentage:_(i).progress.percent},null,8,["width","percentage"])],4),[[z,_(i).progress.percent]])]),_:1},8,["headers","action","data","name","http-request"]),[[z,s.value.length<e.max]]),e.notip?C("",!0):(m(),b("div",pe,[c("div",re,[o(F,{title:`上传图片支持 ${e.ext.join(" / ")} 格式，单张图片大小不超过 ${e.size}MB，建议图片尺寸为 ${e.width}*${e.height}，且图片数量不超过 ${e.max} 张`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),_(i).imageViewerVisible?(m(),j(T,{key:1,"url-list":s.value,"initial-index":_(i).dialogImageIndex,teleported:"",onClose:a},null,8,["url-list","initial-index"])):C("",!0)])}}}),ue=L(de,[["__scopeId","data-v-16870de8"]]),ve=q({__name:"index",setup(y){const h=B("https://picsum.photos/400"),p=B(["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]),$=B([{name:"One-step-admin.png",url:"https://one-step-admin.hurui.me/logo.png"}]);function s(a){a.error===""?h.value=a.data.path:v.warning(a.error)}function i(a){a.error===""?p.value.push(a.data.path):v.warning(a.error)}function E(a,t,r){a.error===""?$.value.push({name:t.name,url:a.error===""?a.data.path:""}):(r.pop(),v.warning(a.error))}return(a,t)=>{const r=W,d=Q,n=K,l=ue,e=te;return m(),b("div",null,[o(r,{title:"上传"},{content:k(()=>t[2]||(t[2]=[c("p",null,"ImageUpload / ImagesUpload / FileUpload",-1),c("p",{style:{"margin-bottom":"0"}}," 由于线上演示环境开启了 Mock ，会导致上传功能报错，请在本地运行并查看演示 ",-1)])),_:1}),o(n,{title:"单图上传"},{default:k(()=>[o(d,{modelValue:_(h),"onUpdate:modelValue":t[0]||(t[0]=f=>N(h)?h.value=f:null),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",width:250,height:150,onOnSuccess:s},null,8,["modelValue"])]),_:1}),o(n,{title:"多图上传（默认最多3张）"},{default:k(()=>[o(l,{modelValue:_(p),"onUpdate:modelValue":t[1]||(t[1]=f=>N(p)?p.value=f:null),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",onOnSuccess:i},null,8,["modelValue"])]),_:1}),o(n,{title:"文件上传（默认最多3个）"},{default:k(()=>[o(e,{files:_($),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/file",onOnSuccess:E},null,8,["files"])]),_:1})])}}});export{ve as default};
